includeConfig 'VERSION'

manifest {
    homePage = 'https://github.com/mirnylab/distiller-nf'
    mainScript = 'distiller.nf'
}

process.container = "mirnylab/distiller_env:${version}"


profiles {


    standard {
        process {
            executor='local'
        }
        executor {
            cpus = 40
        }
    }


    cluster {
        process{

            // default LSF node config
            executor='lsf'
            queue='short'
            memory='8 GB'
            time='4h'

            $download_sra {}

            // use this scope of config
            // to specify LSF submission node
            // configuration. Use 'params'
            // to fine tune cpu requirements
            // for different scipts inside a process
            $fastqc {
                cpus = 4
                memory = '4 GB'
                queue = 'short'
                time = '2h'
            }

            $chunk_fastqs {}

            $map_runs {}

            $parse_runs {}

            $premerge_pairsam_chunks {}

            $merge_pairsam_into_runs {}

            $merge_runs_into_libraries {}

            $merge_stats_runs_into_libraries {}

            $filter_make_pairs {}

            $index_pairs {}

            $bin_library_pairs {}

            $make_library_group_coolers {}

            $merge_stats_libraries_into_groups {}


        }
    }

}




// Use 'params' to fine tune
// cpu requirements for different
// scipts inside a process, for example:
// set npzipin to 2 for all processes
// as pbgzip does not scale further
// for decompression.
// Use process scope to define a node config
// in the LSF submission system.
// Nice way of separating the two things, I believe.
params {
    fastqc_cpus = 4
    chunk_cpus = 8
    map_cpus = 8
    merge_cpus = 8
    parse_cpus = 8
    filter_make_pairs_cpus = 8
    bin_cpus = 20
}

docker {
    enabled = true
    runOptions = '-u $(id -u):$(id -g)'
}

timeline {
    enabled = true
}

trace {
    enabled = true
}

